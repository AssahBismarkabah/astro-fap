---
interface MarkdownInstance {
  frontmatter: any;
  rawContent: () => string;
  url?: string;
}

const postImports = import.meta.glob('./docs/blog/*.md', { eager: true }) as Record<string, MarkdownInstance>;
const posts = Object.entries(postImports).map(([path, mod]) => {
  // Get the raw markdown content
  let preview = '';
  
  if (mod.rawContent) {
    // Get raw markdown content
    const rawText = mod.rawContent();
    const contentWithoutFrontmatter = rawText.replace(/^---[\s\S]*?---\n\n?/, '');
    // Remove markdown syntax but keep more content for longer previews
    const cleanText = contentWithoutFrontmatter
      .replace(/#{1,6}\s+/g, '') // Remove headers
      .replace(/\[([^\]]+)\]\([^\)]+\)/g, '$1') // Remove links but keep text
      .replace(/```[\s\S]*?```/g, '') // Remove code blocks
      .replace(/`[^`]+`/g, '') // Remove inline code
      .replace(/\*\*([^\*]+)\*\*/g, '$1') // Remove bold
      .replace(/\*([^\*]+)\*/g, '$1') // Remove italic
      .replace(/\n+/g, ' ') // Replace newlines with spaces
      .trim();
    // Increase preview length to ~500 characters to show more content
    preview = cleanText.substring(0, 500) + (cleanText.length > 500 ? '...' : '');
  } else if (mod.frontmatter?.description) {
    // Fallback to description if rawContent not available
    preview = mod.frontmatter.description;
  }
  
  return {
    url: path.replace('./docs/blog/', '/docs/blog/').replace('.md', ''),
    frontmatter: mod.frontmatter,
    preview: preview,
  };
});
posts.sort((a, b) => (b.frontmatter.date || '').localeCompare(a.frontmatter.date || ''));

function formatDate(dateString) {
  if (!dateString) return '';
  const date = new Date(dateString);
  return date.toLocaleDateString('en-US', {
    year: 'numeric',
    month: 'long',
    day: 'numeric',
    timeZone: 'UTC'
  });
}
---

<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <title>Blog | Assah Bismark</title>
    <style is:global>
      :root {
        color-scheme: dark;
      }
      
      html {
        background: #030d13;  
      }
      
      html, body {
        font-family: system-ui, sans-serif;
        background: #030d13;
        color: #fff;
        margin: 0;
        padding: 0;
        min-height: 100vh;
      }
      
      * {
        box-sizing: border-box;
      }
    </style>
    <style>
      .blog-container {
        margin-top: 4rem;
        width: 100%;
        max-width: 1200px;
        margin-left: auto;
        margin-right: auto;
        padding: 0 3rem;
        display: flex;
        flex-direction: column;
        align-items: flex-start;
      }
      
      @media (max-width: 1400px) {
        .blog-container {
          max-width: 1000px;
          padding: 0 2.5rem;
        }
      }
      
      @media (max-width: 1200px) {
        .blog-container {
          max-width: 900px;
          padding: 0 2rem;
        }
      }
      
      @media (max-width: 768px) {
        .blog-container {
          max-width: 100%;
          padding: 0 1.5rem;
        }
      }

      .blog-container.selected-post-active {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        margin: 0;
        padding: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        transform: scale(0.6);
        transform-origin: center center;
        background-color: #030d13;
        z-index: 1000;
        overflow: hidden; 
      }

      .blog-title {
        font-size: 2rem;
        font-weight: bold;
        margin-bottom: 2.5rem;
        text-align: left;
        width: 100%;
      }
      .blog-list {
        width: 100%;
        display: flex;
        flex-direction: column;
        gap: 4rem;
      }
      .blog-article {
        text-decoration: none;
        color: inherit;
        display: block;
        width: 100%;
      }
      .blog-article-title {
        font-size: 1.875rem;
        font-weight: 700;
        color: #fff;
        margin-bottom: 1.25rem;
        line-height: 1.2;
      }
      .blog-article-preview {
        font-size: 1.125rem;
        color: #9ca3af;
        line-height: 1.7;
        margin-bottom: 1rem;
        max-width: 100%;
      }
      .blog-article-more {
        font-size: 1rem;
        color: #9ca3af;
        margin-bottom: 1.25rem;
        cursor: pointer;
        display: inline-block;
        text-decoration: none;
      }
      .blog-article-more:hover {
        color: #fff;
      }
      .blog-article-meta {
        display: flex;
        align-items: center;
        gap: 1.5rem;
        font-size: 0.95rem;
        color: #6b7280;
      }
      .blog-article-date {
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }
      .back-link {
        color: #b0b8c1;
        font-size: 1.1rem;
        margin-bottom: 2rem;
        cursor: pointer;
        text-decoration: none;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        transition: color 0.2s ease;
      }
      .back-link:hover {
        color: #fff;
      }
      .post-content-wrapper {
        width: 100%;
        max-width: 800px;
        padding: 2rem;
        display: flex;
        flex-direction: column;
        align-items: flex-start;
        margin: 0 auto;
      }
      .post-content {
        margin-top: 2rem;
        width: 100%;
        color: #fff;
        line-height: 1.6;
      }
      .post-content :global(h1),
      .post-content :global(h2),
      .post-content :global(h3),
      .post-content :global(h4),
      .post-content :global(h5),
      .post-content :global(h6) {
        margin-top: 2rem;
        margin-bottom: 1rem;
      }
      .post-content :global(p) {
        margin-bottom: 1rem;
      }
      .post-content :global(ul),
      .post-content :global(ol) {
        margin-bottom: 1rem;
        padding-left: 2rem;
      }
      .post-content :global(li) {
        margin-bottom: 0.5rem;
      }
      .post-content :global(a) {
        color: #60a5fa;
        text-decoration: none;
      }
      .post-content :global(a:hover) {
        text-decoration: underline;
      }
      .post-content :global(code) {
        background: #1a1a1a;
        padding: 0.2rem 0.4rem;
        border-radius: 0.25rem;
        font-family: monospace;
      }
      .post-content :global(pre) {
        background: #1a1a1a;
        padding: 1rem;
        border-radius: 0.5rem;
        overflow-x: auto;
        margin: 1rem 0;
      }
      .post-content :global(blockquote) {
        border-left: 4px solid #60a5fa;
        margin: 1rem 0;
        padding-left: 1rem;
        color: #b0b8c1;
      }
    </style>
  </head>
  <body>
    <div id="blog-container" class="blog-container">
      <div id="blog-list">
        <a href="/" class="back-link" style="margin-bottom: 1rem;">&larr; Go to Home</a>
        <div class="blog-title">Blog</div>
        {posts.length === 0 ? (
          <div class="mb-8 animate-pulse" style="color:#b0b8c1">Loading articles...</div>
        ) : null}
        {posts.length > 0 ? (
          <div class="blog-list">
            {posts.map(post => (
              <article class="blog-article">
                <a href={post.url} style="text-decoration: none; color: inherit;">
                  <h2 class="blog-article-title">{post.frontmatter.title || post.url.split('/').pop()}</h2>
                </a>
                <p class="blog-article-preview">{post.preview}</p>
                <a href={post.url} class="blog-article-more">More ›</a>
                <div class="blog-article-meta">
                  <div class="blog-article-date">{formatDate(post.frontmatter.date)}</div>
                </div>
              </article>
            ))}
          </div>
        ) : null}
      </div>
    </div>

    <script define:vars={{ posts }}>
      let selectedPost = null;
      const blogContainer = document.getElementById('blog-container');
      const blogList = document.getElementById('blog-list');

      function selectPost(post) {
        selectedPost = post;
        blogContainer.classList.add('selected-post-active');
        
        // Create a temporary div to render the Content component
        const tempDiv = document.createElement('div');
        tempDiv.innerHTML = `
          <div class="post-content-wrapper">
            <div class="back-link" onclick="goBack()">&larr; Blog</div>
            <div class="blog-article-date">${formatDate(post.frontmatter.date)}</div>
            <div class="blog-article-title" style="font-size:2rem; margin-bottom:1.5rem;">${post.frontmatter.title || ''}</div>
            <div class="post-content">
              ${post.content}
            </div>
          </div>
        `;
        
        blogList.innerHTML = '';
        blogList.appendChild(tempDiv.firstElementChild);
      }

      function goBack() {
        selectedPost = null;
        blogContainer.classList.remove('selected-post-active');
        blogList.innerHTML = `
          <a href="/" class="back-link" style="margin-bottom: 1rem;">&larr; Go to Home</a>
          <div class="blog-title">Blog</div>
          ${posts.length === 0 ? '<div class="mb-8 animate-pulse" style="color:#b0b8c1">Loading articles...</div>' : ''}
          ${posts.length > 0 ? `
            <div class="blog-list">
              ${posts.map(post => `
                <article class="blog-article">
                  <a href="${post.url}" style="text-decoration: none; color: inherit;">
                    <h2 class="blog-article-title">${post.frontmatter.title || post.url.split('/').pop()}</h2>
                  </a>
                  <p class="blog-article-preview">${post.preview}</p>
                  <a href="${post.url}" class="blog-article-more">More ›</a>
                  <div class="blog-article-meta">
                    <div class="blog-article-date">${formatDate(post.frontmatter.date)}</div>
                  </div>
                </article>
              `).join('')}
            </div>
          ` : ''}
        `;
        attachEventListeners();
      }

      function formatDate(dateString) {
        if (!dateString) return '';
        const date = new Date(dateString);
        return date.toLocaleDateString('en-US', {
          year: 'numeric',
          month: 'long',
          day: 'numeric',
          timeZone: 'UTC'
        });
      }

      function attachEventListeners() {
        document.querySelectorAll('.blog-article-link').forEach(link => {
          link.addEventListener('click', () => {
            const postUrl = link.getAttribute('href');
            const post = posts.find(p => p.url === postUrl);
            if (post) {
              selectPost(post);
            }
          });
        });
      }

      // Initial event listener attachment
      attachEventListeners();
    </script>
  </body>
</html>
