---
interface MarkdownInstance {
  frontmatter: any;
  rawContent: () => string;
  url?: string;
}

const postImports = import.meta.glob('./docs/blog/*.md', { eager: true }) as Record<string, MarkdownInstance>;
const posts = Object.entries(postImports).map(([path, mod]) => {
  // Get the raw markdown content
  let preview = '';

  if (mod.rawContent) {
    // Get raw markdown content
    const rawText = mod.rawContent();
    const contentWithoutFrontmatter = rawText.replace(/^---[\s\S]*?---\n\n?/, '');
    // Remove markdown syntax but keep more content for longer previews
    const cleanText = contentWithoutFrontmatter
      .replace(/#{1,6}\s+/g, '') // Remove headers
      .replace(/\[([^\]]+)\]\([^\)]+\)/g, '$1') // Remove links but keep text
      .replace(/```[\s\S]*?```/g, '') // Remove code blocks
      .replace(/`[^`]+`/g, '') // Remove inline code
      .replace(/\*\*([^\*]+)\*\*/g, '$1') // Remove bold
      .replace(/\*([^\*]+)\*/g, '$1') // Remove italic
      .replace(/\n+/g, ' ') // Replace newlines with spaces
      .trim();
    // Increase preview length to ~500 characters to show more content
    preview = cleanText.substring(0, 500) + (cleanText.length > 500 ? '...' : '');
  } else if (mod.frontmatter?.description) {
    // Fallback to description if rawContent not available
    preview = mod.frontmatter.description;
  }

  return {
    url: path.replace('./docs/blog/', '/docs/blog/').replace('.md', ''),
    frontmatter: mod.frontmatter,
    preview: preview,
    category: mod.frontmatter?.category || 'technical',
  };
});
posts.sort((a, b) => (b.frontmatter.date || '').localeCompare(a.frontmatter.date || ''));

// Separate posts by category
const technicalPosts = posts.filter(p => p.category === 'technical');
const reflectionPosts = posts.filter(p => p.category === 'reflections');

function formatDate(dateString) {
  if (!dateString) return '';
  const date = new Date(dateString);
  return date.toLocaleDateString('en-US', {
    year: 'numeric',
    month: 'long',
    day: 'numeric',
    timeZone: 'UTC'
  });
}
---

<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />
    <title>Blog | Assah Bismark</title>
    <style is:global>
      :root {
        color-scheme: dark;
      }
      
      html {
        background: #00030d;  
      }
      
      html, body {
        font-family: system-ui, sans-serif;
        background: #00030d;
        color: #fff;
        margin: 0;
        padding: 0;
        min-height: 100vh;
      }
      
      * {
        box-sizing: border-box;
      }
    </style>
    <style>
      .blog-container {
        margin-top: 6rem;
        width: 100%;
        max-width: 800px;
        margin-left: auto;
        margin-right: auto;
        padding: 0 4rem;
        display: flex;
        flex-direction: column;
        align-items: flex-start;
      }

      @media (max-width: 1200px) {
        .blog-container {
          max-width: 700px;
          padding: 0 3rem;
        }
      }

      @media (max-width: 768px) {
        .blog-container {
          max-width: 100%;
          padding: 0 2rem;
        }
      }

      .blog-container.selected-post-active {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        margin: 0;
        padding: 0;
        display: flex;
        align-items: center;
        justify-content: center;
        transform: scale(0.6);
        transform-origin: center center;
        background-color: #00030d;
        z-index: 1000;
        overflow: hidden; 
      }

      .blog-title {
        font-size: 2rem;
        font-weight: bold;
        margin-bottom: 2.5rem;
        text-align: left;
        width: 100%;
      }
      .blog-list {
        width: 100%;
        display: flex;
        flex-direction: column;
        gap: 4rem;
      }
      .blog-article {
        text-decoration: none;
        color: inherit;
        display: block;
        width: 100%;
        opacity: 0;
        transform: translateY(30px);
        transition: opacity 0.6s ease, transform 0.6s ease;
      }
      .blog-article.visible {
        opacity: 1;
        transform: translateY(0);
      }
      .blog-article-title {
        font-size: 1.875rem;
        font-weight: 700;
        color: #fff;
        margin-bottom: 1.25rem;
        line-height: 1.2;
      }
      .blog-article-preview {
        font-size: 1.125rem;
        color: #9ca3af;
        line-height: 1.7;
        margin-bottom: 1rem;
        max-width: 100%;
      }
      .blog-article-more {
        font-size: 1rem;
        color: #9ca3af;
        margin-bottom: 1.25rem;
        cursor: pointer;
        display: inline-block;
        text-decoration: none;
      }
      .blog-article-more:hover {
        color: #fff;
      }
      .blog-article-meta {
        display: flex;
        align-items: center;
        gap: 1.5rem;
        font-size: 0.95rem;
        color: #6b7280;
      }
      .blog-article-date {
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }
      .back-link {
        color: #b0b8c1;
        font-size: 1.1rem;
        margin-bottom: 2rem;
        cursor: pointer;
        text-decoration: none;
        display: flex;
        align-items: center;
        gap: 0.5rem;
        transition: color 0.2s ease;
      }
      .back-link:hover {
        color: #fff;
      }
      .tabs-container {
        display: flex;
        gap: 1.5rem;
        margin-bottom: 3rem;
        width: 100%;
        border-bottom: 1px solid #1f2937;
        padding-bottom: 0;
      }
      .tab-btn {
        background: transparent;
        border: none;
        border-bottom: 2px solid transparent;
        padding: 0.75rem 0.25rem;
        margin-bottom: -1px;
        font-family: 'SF Pro', 'SF Pro Display', 'SF Pro Text', 'San Francisco', system-ui, sans-serif;
        font-size: 1.1rem;
        font-weight: 500;
        color: #6b7280;
        cursor: pointer;
        transition: all 0.2s ease;
      }
      .tab-btn:hover {
        color: #e5e7eb;
      }
      .tab-btn.active {
        color: #fff;
        border-bottom-color: #fff;
      }
      .tab-content {
        display: none;
        width: 100%;
      }
      .tab-content.active {
        display: block;
      }
      .empty-state {
        color: #6b7280;
        font-size: 1.1rem;
        text-align: center;
        padding: 3rem 1rem;
      }
      .post-content-wrapper {
        width: 100%;
        max-width: 800px;
        padding: 2rem;
        display: flex;
        flex-direction: column;
        align-items: flex-start;
        margin: 0 auto;
      }
      .post-content {
        margin-top: 2rem;
        width: 100%;
        color: #fff;
        line-height: 1.6;
      }
      .post-content :global(h1),
      .post-content :global(h2),
      .post-content :global(h3),
      .post-content :global(h4),
      .post-content :global(h5),
      .post-content :global(h6) {
        margin-top: 2rem;
        margin-bottom: 1rem;
      }
      .post-content :global(p) {
        margin-bottom: 1rem;
      }
      .post-content :global(ul),
      .post-content :global(ol) {
        margin-bottom: 1rem;
        padding-left: 2rem;
      }
      .post-content :global(li) {
        margin-bottom: 0.5rem;
      }
      .post-content :global(a) {
        color: #60a5fa;
        text-decoration: none;
      }
      .post-content :global(a:hover) {
        text-decoration: underline;
      }
      .post-content :global(code) {
        background: #1a1a1a;
        padding: 0.2rem 0.4rem;
        border-radius: 0.25rem;
        font-family: monospace;
      }
      .post-content :global(pre) {
        background: #1a1a1a;
        padding: 1rem;
        border-radius: 0.5rem;
        overflow-x: auto;
        margin: 1rem 0;
      }
      .post-content :global(blockquote) {
        border-left: 4px solid #60a5fa;
        margin: 1rem 0;
        padding-left: 1rem;
        color: #b0b8c1;
      }
    </style>
  </head>
  <body>
    <div id="blog-container" class="blog-container">
      <div id="blog-list">
        <a href="/" class="back-link" style="margin-bottom: 1rem;">&larr; Go to Home</a>
        <div class="blog-title">Blog</div>

        <div class="tabs-container">
          <button class="tab-btn active" data-tab="technical">Technical Writeups</button>
          <button class="tab-btn" data-tab="reflections">Reflections</button>
        </div>

        <div id="technical-content" class="tab-content active">
          {technicalPosts.length === 0 ? (
            <div class="empty-state">No technical writeups yet. Check back soon!</div>
          ) : (
            <div class="blog-list">
              {technicalPosts.map(post => (
                <article class="blog-article">
                  <a href={post.url} style="text-decoration: none; color: inherit;">
                    <h2 class="blog-article-title">{post.frontmatter.title || post.url.split('/').pop()}</h2>
                  </a>
                  <p class="blog-article-preview">{post.preview}</p>
                  <a href={post.url} class="blog-article-more">More ›</a>
                  <div class="blog-article-meta">
                    <div class="blog-article-date">{formatDate(post.frontmatter.date)}</div>
                  </div>
                </article>
              ))}
            </div>
          )}
        </div>

        <div id="reflections-content" class="tab-content">
          {reflectionPosts.length === 0 ? (
            <div class="empty-state">No reflections yet. Check back soon!</div>
          ) : (
            <div class="blog-list">
              {reflectionPosts.map(post => (
                <article class="blog-article">
                  <a href={post.url} style="text-decoration: none; color: inherit;">
                    <h2 class="blog-article-title">{post.frontmatter.title || post.url.split('/').pop()}</h2>
                  </a>
                  <p class="blog-article-preview">{post.preview}</p>
                  <a href={post.url} class="blog-article-more">More ›</a>
                  <div class="blog-article-meta">
                    <div class="blog-article-date">{formatDate(post.frontmatter.date)}</div>
                  </div>
                </article>
              ))}
            </div>
          )}
        </div>
      </div>
    </div>

    <script define:vars={{ posts }}>
      let selectedPost = null;
      const blogContainer = document.getElementById('blog-container');
      const blogList = document.getElementById('blog-list');

      function selectPost(post) {
        selectedPost = post;
        blogContainer.classList.add('selected-post-active');
        
        // Create a temporary div to render the Content component
        const tempDiv = document.createElement('div');
        tempDiv.innerHTML = `
          <div class="post-content-wrapper">
            <div class="back-link" onclick="goBack()">&larr; Blog</div>
            <div class="blog-article-date">${formatDate(post.frontmatter.date)}</div>
            <div class="blog-article-title" style="font-size:2rem; margin-bottom:1.5rem;">${post.frontmatter.title || ''}</div>
            <div class="post-content">
              ${post.content}
            </div>
          </div>
        `;
        
        blogList.innerHTML = '';
        blogList.appendChild(tempDiv.firstElementChild);
      }

      function goBack() {
        selectedPost = null;
        blogContainer.classList.remove('selected-post-active');
        blogList.innerHTML = `
          <a href="/" class="back-link" style="margin-bottom: 1rem;">&larr; Go to Home</a>
          <div class="blog-title">Blog</div>
          ${posts.length === 0 ? '<div class="mb-8 animate-pulse" style="color:#b0b8c1">Loading articles...</div>' : ''}
          ${posts.length > 0 ? `
            <div class="blog-list">
              ${posts.map(post => `
                <article class="blog-article">
                  <a href="${post.url}" style="text-decoration: none; color: inherit;">
                    <h2 class="blog-article-title">${post.frontmatter.title || post.url.split('/').pop()}</h2>
                  </a>
                  <p class="blog-article-preview">${post.preview}</p>
                  <a href="${post.url}" class="blog-article-more">More ›</a>
                  <div class="blog-article-meta">
                    <div class="blog-article-date">${formatDate(post.frontmatter.date)}</div>
                  </div>
                </article>
              `).join('')}
            </div>
          ` : ''}
        `;
        attachEventListeners();
      }

      function formatDate(dateString) {
        if (!dateString) return '';
        const date = new Date(dateString);
        return date.toLocaleDateString('en-US', {
          year: 'numeric',
          month: 'long',
          day: 'numeric',
          timeZone: 'UTC'
        });
      }

      function attachEventListeners() {
        document.querySelectorAll('.blog-article-link').forEach(link => {
          link.addEventListener('click', () => {
            const postUrl = link.getAttribute('href');
            const post = posts.find(p => p.url === postUrl);
            if (post) {
              selectPost(post);
            }
          });
        });
      }

      // Tab switching functionality
      function initTabs() {
        const tabBtns = document.querySelectorAll('.tab-btn');
        const technicalContent = document.getElementById('technical-content');
        const reflectionsContent = document.getElementById('reflections-content');

        function switchTab(tab) {
          tabBtns.forEach(b => {
            if (b.getAttribute('data-tab') === tab) {
              b.classList.add('active');
            } else {
              b.classList.remove('active');
            }
          });

          if (tab === 'technical') {
            technicalContent.classList.add('active');
            reflectionsContent.classList.remove('active');
          } else {
            technicalContent.classList.remove('active');
            reflectionsContent.classList.add('active');
          }
        }

        tabBtns.forEach(btn => {
          btn.addEventListener('click', () => {
            const tab = btn.getAttribute('data-tab');
            switchTab(tab);
            // Update URL hash without scrolling
            history.replaceState(null, '', '#' + tab);
          });
        });

        // Handle initial hash from URL
        const hash = window.location.hash.replace('#', '');
        if (hash === 'reflections') {
          switchTab('reflections');
        }
      }

      // Scroll reveal animation
      function initScrollReveal() {
        const articles = document.querySelectorAll('.blog-article');

        const observer = new IntersectionObserver((entries) => {
          entries.forEach((entry, index) => {
            if (entry.isIntersecting) {
              // Add a small delay for each article for staggered effect
              setTimeout(() => {
                entry.target.classList.add('visible');
              }, index * 100);
              observer.unobserve(entry.target);
            }
          });
        }, {
          threshold: 0.1,
          rootMargin: '0px 0px -50px 0px'
        });

        articles.forEach(article => observer.observe(article));
      }

      // Initial event listener attachment
      attachEventListeners();
      initTabs();
      initScrollReveal();
    </script>
  </body>
</html>
